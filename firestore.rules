rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if user is admin
    // Note: In production, rely on Custom Claims or a persistent Admin collection.
    // For this "no backend" milestone, we trust the client-side check for UI,
    // but here we should ideally check against a known list or claim.
    // Since we don't have a backend to set claims, we will rely on a hardcoded list check here 
    // OR just allow write if authenticated for now (DANGEROUS but fits the step).
    // BETTER: Create an 'admins' collection that only you can write to manually in console.
    
    function isAdmin() {
      return request.auth != null && exists(/databases/$(database)/documents/admins/$(request.auth.token.email));
    }

    // Allow public read, admin write for everything content-related
    match /posts/{postId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    match /pages/{pageId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    match /settings/{settingId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    match /media/{mediaId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Public can subscribe/send messages, but only admin can read/manage
    match /newsletter_subscriptions/{subId} {
      allow create: if true;
      allow read, update, delete: if isAdmin();
    }

    match /contact_messages/{msgId} {
      allow create: if true;
      allow read, update, delete: if isAdmin();
    }
    
    // Admin whitelist collection - manually add your email document here!
    // Collection: admins, Document ID: fakhrizafauzii@gmail.com
    match /admins/{email} {
      allow read: if request.auth != null;
      allow write: if false; // Only manageable via Console
    }
  }
}
